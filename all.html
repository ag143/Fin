<!DOCTYPE html>
<html>

<body>
<select name="stock">
 <option value="Result_ACC.txt"/>
 <option value="Result_ADANIENT.txt"/>
 <option value="Result_ADANIPORTS.txt"/>
 <option value="Result_AMBUJACEM.txt"/>
 <option value="Result_ARVIND.txt"/>
 <option value="Result_ASHOKLEY.txt"/>
 <option value="Result_ASIANPAINT.txt"/>
 <option value="Result_AUROPHARMA.txt"/>
 <option value="Result_AXISBANK.txt"/>
 <option value="Result_BAJAJ-AUTO.txt"/>
 <option value="Result_BAJFINANCE.txt"/>
 <option value="Result_BANKBARODA.txt"/>
 <option value="Result_BANKINDIA.txt"/>
 <option value="Result_BANKNIFTY.txt"/>
 <option value="Result_BHARATFORG.txt"/>
 <option value="Result_BHARTIARTL.txt"/>
 <option value="Result_BHEL.txt"/>
 <option value="Result_BOSCHLTD.txt"/>
 <option value="Result_BPCL.txt"/>
 <option value="Result_CANBK.txt"/>
 <option value="Result_CENTURYTEX.txt"/>
 <option value="Result_CIPLA.csv"/>
 <option value="Result_CIPLA.txt"/>
 <option value="Result_CNX-IT.csv"/>
 <option value="Result_CNX-IT.txt"/>
 <option value="Result_CNX100.csv"/>
 <option value="Result_CNX100.txt"/>
 <option value="Result_CNX500.csv"/>
 <option value="Result_CNX500.txt"/>
 <option value="Result_CNXENERGY.csv"/>
 <option value="Result_CNXENERGY.txt"/>
 <option value="Result_CNXFMCG.csv"/>
 <option value="Result_CNXFMCG.txt"/>
 <option value="Result_COALINDIA.csv"/>
 <option value="Result_COALINDIA.txt"/>
 <option value="Result_DISHTV.csv"/>
 <option value="Result_DISHTV.txt"/>
 <option value="Result_DLF.csv"/>
 <option value="Result_DLF.txt"/>
 <option value="Result_DRREDDY.csv"/>
 <option value="Result_DRREDDY.txt"/>
 <option value="Result_EICHERMOT.csv"/>
 <option value="Result_EICHERMOT.txt"/>
 <option value="Result_GAIL.csv"/>
 <option value="Result_GAIL.txt"/>
 <option value="Result_GOLDBEES.csv"/>
 <option value="Result_GOLDBEES.txt"/>
 <option value="Result_GRASIM.csv"/>
 <option value="Result_GRASIM.txt"/>
 <option value="Result_HCLTECH.csv"/>
 <option value="Result_HCLTECH.txt"/>
 <option value="Result_HDFC.csv"/>
 <option value="Result_HDFC.txt"/>
 <option value="Result_HDFCBANK.csv"/>
 <option value="Result_HDFCBANK.txt"/>
 <option value="Result_HEROMOTOCO.csv"/>
 <option value="Result_HEROMOTOCO.txt"/>
 <option value="Result_HINDALCO.csv"/>
 <option value="Result_HINDALCO.txt"/>
 <option value="Result_HINDPETRO.csv"/>
 <option value="Result_HINDPETRO.txt"/>
 <option value="Result_HINDUNILVR.csv"/>
 <option value="Result_HINDUNILVR.txt"/>
 <option value="Result_IBULHSGFIN.csv"/>
 <option value="Result_IBULHSGFIN.txt"/>
 <option value="Result_ICICIBANK.csv"/>
 <option value="Result_ICICIBANK.txt"/>
 <option value="Result_IDBI.csv"/>
 <option value="Result_IDBI.txt"/>
 <option value="Result_IDEA.csv"/>
 <option value="Result_IDEA.txt"/>
 <option value="Result_IDFC.csv"/>
 <option value="Result_IDFC.txt"/>
 <option value="Result_INDUSINDBK.csv"/>
 <option value="Result_INDUSINDBK.txt"/>
 <option value="Result_INFRATEL.csv"/>
 <option value="Result_INFRATEL.txt"/>
 <option value="Result_INFY.csv"/>
 <option value="Result_INFY.txt"/>
 <option value="Result_IOC.csv"/>
 <option value="Result_IOC.txt"/>
 <option value="Result_ITC.csv"/>
 <option value="Result_ITC.txt"/>
 <option value="Result_JINDALSTEL.csv"/>
 <option value="Result_JINDALSTEL.txt"/>
 <option value="Result_JSWSTEEL.csv"/>
 <option value="Result_JSWSTEEL.txt"/>
 <option value="Result_KOTAKBANK.csv"/>
 <option value="Result_KOTAKBANK.txt"/>
 <option value="Result_LICHSGFIN.csv"/>
 <option value="Result_LICHSGFIN.txt"/>
 <option value="Result_LUPIN.csv"/>
 <option value="Result_LUPIN.txt"/>
 <option value="Result_M&M.csv"/>
 <option value="Result_M&M.txt"/>
 <option value="Result_MARUTI.csv"/>
 <option value="Result_MARUTI.txt"/>
 <option value="Result_NIFTY.csv"/>
 <option value="Result_NIFTY.txt"/>
 <option value="Result_NIFTYINFRA.csv"/>
 <option value="Result_NIFTYINFRA.txt"/>
 <option value="Result_NIFTYMETAL.csv"/>
 <option value="Result_NIFTYMETAL.txt"/>
 <option value="Result_NMDC.csv"/>
 <option value="Result_NMDC.txt"/>
 <option value="Result_NTPC.csv"/>
 <option value="Result_NTPC.txt"/>
 <option value="Result_ONGC.csv"/>
 <option value="Result_ONGC.txt"/>
 <option value="Result_PFC.csv"/>
 <option value="Result_PFC.txt"/>
 <option value="Result_PNB.csv"/>
 <option value="Result_PNB.txt"/>
 <option value="Result_POWERGRID.csv"/>
 <option value="Result_POWERGRID.txt"/>
 <option value="Result_RCOM.csv"/>
 <option value="Result_RCOM.txt"/>
 <option value="Result_RELCAPITAL.csv"/>
 <option value="Result_RELCAPITAL.txt"/>
 <option value="Result_RELIANCE.csv"/>
 <option value="Result_RELIANCE.txt"/>
 <option value="Result_RELINFRA.csv"/>
 <option value="Result_RELINFRA.txt"/>
 <option value="Result_RPOWER.csv"/>
 <option value="Result_RPOWER.txt"/>
 <option value="Result_SAIL.csv"/>
 <option value="Result_SAIL.txt"/>
 <option value="Result_SBIN.csv"/>
 <option value="Result_SBIN.txt"/>
 <option value="Result_SIEMENS.csv"/>
 <option value="Result_SIEMENS.txt"/>
 <option value="Result_SUNPHARMA.csv"/>
 <option value="Result_SUNPHARMA.txt"/>
 <option value="Result_SUNTV.csv"/>
 <option value="Result_SUNTV.txt"/>
 <option value="Result_TATAGLOBAL.csv"/>
 <option value="Result_TATAGLOBAL.txt"/>
 <option value="Result_TATAMOTORS.csv"/>
 <option value="Result_TATAMOTORS.txt"/>
 <option value="Result_TATAPOWER.csv"/>
 <option value="Result_TATAPOWER.txt"/>
 <option value="Result_TATASTEEL.csv"/>
 <option value="Result_TATASTEEL.txt"/>
 <option value="Result_TCS.csv"/>
 <option value="Result_TCS.txt"/>
 <option value="Result_TECHM.csv"/>
 <option value="Result_TECHM.txt"/>
 <option value="Result_TITAN.csv"/>
 <option value="Result_TITAN.txt"/>
 <option value="Result_ULTRACEMCO.csv"/>
 <option value="Result_ULTRACEMCO.txt"/>
 <option value="Result_UNIONBANK.csv"/>
 <option value="Result_UNIONBANK.txt"/>
 <option value="Result_UPL.csv"/>
 <option value="Result_UPL.txt"/>
 <option value="Result_VEDL.csv"/>
 <option value="Result_VEDL.txt"/>
 <option value="Result_VOLTAS.csv"/>
 <option value="Result_VOLTAS.txt"/>
 <option value="Result_WIPRO.csv"/>
 <option value="Result_WIPRO.txt"/>
 <option value="Result_WOCKPHARMA.csv"/>
 <option value="Result_WOCKPHARMA.txt"/>
 <option value="Result_YESBANK.csv"/>
 <option value="Result_YESBANK.txt"/>
 <option value="Result_ZEEL.csv"/>
 <option value="Result_ZEEL.txt"/>
 </select>
	<h3><a href="#footer">Go to bottom</a> for Analysis Report</h3>
	<br>
	<input id="selection" type=text value="Result_ADANIENT.txt">
	<button onClick=scan()>scan</button>
	<pre id="fileDisplayArea" class="collapsible"><pre>
	<footer id="footer"></footer>
	<script>

function scan(){
var stockSelection = document.getElementById('selection').value
 var o = [], h = [], l = [], c=[], d=[], t=[], s=[], RSIchange = [], RSIGain = [], RSILoss = [],RSIAvgGain = [], RSIAvgLoss = [], RSIRS =  [],RSIRSI =[],RSI14DAYTRIAL = [];
 var lineoutput,  details;
var transactions=[],transactionStart=[],transactionEnd=[],transactionID=[], TransactionProfitOrLoss=[],TotalProfitAndLoss=0,transactionIterator=0;
var EMA1=[],EMA2=[], PreviousEMA1=[],PreviousEMA2=[],MACD=[],SignalLine=[];
var option = "";
var investment = 100000.00;
var initialInvestment = investment;
var isRSIchecked="false",isMACDChecked="false",isEMA1Checked="false",isEMA2Checked="false",isBuydone="false";
var output1="";
	
 var f = new XMLHttpRequest();
    f.open("GET", stockSelection, false);
    f.onreadystatechange = function ()
    {
        if(f.readyState === 4)
        {
            if(f.status === 200 || f.status == 0)
            {
                var res= f.responseText;
                alert(res);
		    console.log(res);
		 
		   lineoutput = res.split("\n");
					for (var x=0;x<lineoutput.length;x++)
					{
// 					console.log("output-->"+lineoutput[x]);
				        details= lineoutput[x].split(",");
					s.push(details[0]);
					d.push(details[1]);
					t.push(details[2]);					
					o.push(details[3]);
					h.push(details[4]);
					l.push(details[5]);
					c.push(details[6]);
					}
		    
// 		    for (var y=0;y<s.length;y++)
// 			  console.log("----->"+s[y]+","+d[y]+","+t[y]+","+o[y]+","+h[y]+","+l[y]+","+c[y]);

		    option = "RSI";
					nMovingAverage = 2;
					nMovingAverage1 =12;
					nMovingAverage2 =26;
					
					//initial configuration
					for(var x=0;x<c.length;x++)
					{
					PreviousEMA1[x] = 0.0;
					PreviousEMA2[x] = 0.0;
					SignalLine [x]=0.0;
					RSIchange[x]=0.0;
					
					

					if(x>0)
					RSIchange[x] = c[x]-c[x-1];
					else
					RSIchange[x] = 0.0;
					
					if(parseFloat(RSIchange[x]) > 0.0)
					RSIGain[x] = RSIchange[x];
					else 
					RSIGain[x] = 0.0;
					if(parseFloat(RSIchange[x]) < 0.0)
					RSILoss[x] = RSIchange[x];
					else
					RSILoss[x] = 0.0;
					
					console.log("close:"+c[y]+"--->RSI change:"+RSIchange[x]+"--- >RSI GAIN:"+RSIGain[x]+"-- >RSI LOSS:"+RSILoss[x] );
					if(x<14)
					{
					RSIAvgGain[x]=0.0;
					RSIAvgLoss[x]=0.0;
					RSIRS[x]=0.0;
					}
					RSIAvgLoss[x]=0.0;
					RSIAvgGain[x]=0.0;
					if(x==14)
					  {
						for(var y =0;y<14;y++){
							RSIAvgGain[x]= parseFloat(RSIAvgGain[x]) + parseFloat(RSIGain[y]);
							RSIAvgLoss[x]= parseFloat(RSIAvgLoss[x]) + parseFloat(RSILoss[y]);
							}
						RSIAvgGain[x] = parseFloat(RSIAvgGain[x])/14;
						RSIAvgLoss[x] = parseFloat(RSIAvgLoss[x])/14;
						if(RSIAvgLoss[x]<0)
						RSIAvgLoss[x]= -RSIAvgLoss[x];
						RSIRS[x]=parseFloat(RSIAvgGain[x])/parseFloat(RSIAvgLoss[x]);
						RSIRSI[x]=100- 100/(1+RSIRS[x]);
						console.log("RSI Indicator----------------------------------------------------------- >"+parseFloat(RSIRSI[x]));
					  }
					if(x>14)
					  {
						RSIAvgGain[x]= (parseFloat(RSIAvgGain[x-1])*13 +parseFloat(RSIGain[x]))/14;
						RSIAvgLoss[x]= (parseFloat(RSIAvgLoss[x-1])*13 +parseFloat(RSILoss[x]))/14;
						if(RSIAvgLoss[x]<0)
						RSIAvgLoss[x]= -RSIAvgLoss[x];
						RSIRS[x]=parseFloat(RSIAvgGain[x])/parseFloat(RSIAvgLoss[x]);
						RSIRSI[x]=100- 100/(1+RSIRS[x]);
						console.log("RSI Indicator------------------------------------------------------------------------------------------ >"+parseFloat(RSIRSI[x]));
					  }
					  
					  
					}
		    
		    PreviousEMA1= fEMA(c,nMovingAverage1,PreviousEMA1);
					PreviousEMA2= fEMA(c,nMovingAverage2,PreviousEMA2);
					
					
					for(var x=0;x<c.length ;x++)
					{
					console.log("PreviousEMA1["+x+"]"+"---- >"+PreviousEMA1[x]);
					MACD[x]=PreviousEMA1[x]-PreviousEMA2[x];
					
					}
					SignalLine = fEMA(MACD,12,SignalLine);
					
					output1  =output1 + "<table border=5>";
					output1  =output1 + "<tr><th>slno<th>Symbol<th>Date<th>time<th>Open<th>High<th>Low<th>close<th>"+nMovingAverage1+" days EMA <th>"+nMovingAverage2+" days EMA<th>MACD<th>SignalLine<th>RSI<th>BUY/SELL<th>Qty<th>price<th>total<th>profit/loss</tr>";
					
					
					// Prerequisites
					
					
					for (var y=0;y<o.length-1;y++){
						output1= output1+"<tr><td>"+y+"<td>"+s[y]+"<td>"+d[y]+"<td>"+t[y]+"<td>"+o[y]+"<td>"+h[y]+"<td>"+l[y]+"<td>"+c[y];
						if(option=="RSI")
						 {
						
						
						  output1= output1+"<td> "+parseFloat(PreviousEMA1[y]).toFixed(2);
						  output1= output1+"<td> "+parseFloat(PreviousEMA2[y]).toFixed(2);
						  output1= output1+"<td> "+parseFloat(MACD[y]).toFixed(2);
						  output1= output1+"<td> "+parseFloat(SignalLine[y]).toFixed(2);
						  output1= output1+"<td> "+parseFloat(RSIRSI[y]).toFixed(2);
						  
						  console.log(PreviousEMA1[y]-PreviousEMA2[y]);
						  if(RSIRSI[y]<30 && investment>10000 && isBuydone=="false" && y>26){
							isBuydone="true";
						    output1= output1+"<td>BUY";
							transactionIterator= transactionIterator+1;
							
							transactionID[transactionIterator]=transactionIterator;
							
							output1= output1+"<td>10";
							
							investment = investment - c[y]*10;
							transactionStart[transactionIterator]=c[y]*10;
							
							}
						else if(RSIRSI[y]>70 && investment>10000 && isBuydone=="true"){
						    isBuydone="false";
							output1= output1+"<td>SELL";
							
							output1= output1+"<td>10";
							investment = investment + c[y]*10;
							transactionEnd[transactionIterator]=c[y]*10;
							
							}
						else
							{
							output1= output1+"<td>";
							output1= output1+"<td>";
							}
						output1= output1+"<td>";
						output1= output1+"<td>";
						output1= output1+"<td>"+investment;
						output1= output1+"</tr>";
							
							
						 }
						 
						
						}
		
					output1  =output1 + "</table>";
					
					
					output1= output1 +"<br><br><br><br><br>";
					
					
					output1= output1 +"<h1> Analysis Report</h1>";
					
					
					output1= output1 +"<table border=5>";
					
					output1= output1 +"<tr><th>slno<th>Stock Bought<th>Stock Sold<th> Profit or Loss</tr>";
					
					
					
					for (var z=1;z<transactionIterator+1;z++){
					
					if(transactionStart[z]>transactionEnd[z])
						TransactionProfitOrLoss[z] = (transactionEnd[z]- transactionStart[z]);
					else
						TransactionProfitOrLoss[z] = (transactionEnd[z]-transactionStart[z]);
					
					TotalProfitAndLoss=TotalProfitAndLoss+TransactionProfitOrLoss[z];
					output1= output1 +"<tr>"+
					"<td>"+z+
					"<td>"+transactionStart[z]+
					"<td>"+transactionEnd[z]+
					"<td>"+TransactionProfitOrLoss[z]+
					
					"</tr>";
					}
					
		   			 output1= output1+ "<tr>"+
					"<td colspan=3><b>Total Profit or Loss</b><td>"+TotalProfitAndLoss+
					 "</tr>";
		    
		    			output1= output1+ "<tr>"+
					"<td><b>Initial Investment</b><td>"+initialInvestment+"<td><b>InvestmentLeft</b><td>"+investment
					 "</tr>";
					
					output1= output1 +"</table>";
					
					
					fileDisplayArea.innerHTML= output1;
		    
            }
        }
    }
    f.send(null);
	
}
		
function fSMA(c,y,n){
			var total =0.0; 
			
		      if(y>=n)
		      for(var i=n;i>0;i--)
		      total = parseFloat(total) + parseFloat(c[y-i]);
		 
		      return total/n;
		
		
		    }
			function fEMA(c,n,PreviousEMA){
			  for(var x=0;x<c.length;x++)
					{
					if(x==n)
					{
					for(var y=n;y>0;y--)
					{
					PreviousEMA[n]=parseFloat(PreviousEMA[n])+parseFloat(c[y]);
					
					}
					PreviousEMA[n]=PreviousEMA[n]/n;
					}
					if(x>n)
					{
					var k= 2/ (parseInt(n)+1);
					PreviousEMA[x]=c[x]*k + PreviousEMA[x-1]*(1-k);
					
					}
					}
					return PreviousEMA;
			}

	</script>
	<script>
	</script>
</body>
</html>
\
